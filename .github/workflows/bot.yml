name: Aceh Weather Bot v2

on:
  schedule:
    # Runs every 15 minutes to stay well within API rate limits
    - cron: "*/15 * * * *" 
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # Step 1: Download the cached IDs from the previous run (using v4)
      - name: Download User IDs Cache
        uses: actions/download-artifact@v4
        with:
          name: source-user-ids-cache
          path: .
        # Use continue-on-error: true to prevent failure on the first run when the artifact doesn't exist
        continue-on-error: true
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          
      - run: pip install tweepy
      
      # Step 2: Run the bot script
      - name: Run Bot Script
        run: python bot.py
        env:
          BEARER_TOKEN: ${{ secrets.BEARER_TOKEN }}
          API_KEY: ${{ secrets.API_KEY }}
          API_SECRET: ${{ secrets.API_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_SECRET: ${{ secrets.ACCESS_SECRET }}
          
      # Step 3: Upload the IDs file for the next run (using v4)
      - name: Upload User IDs Cache
        uses: actions/upload-artifact@v4
        with:
          name: source-user-ids-cache
          path: source_ids.json
          # Ensures the job doesn't fail if the file wasn't created (e.g., due to an earlier error)
          if-no-files-found: ignore
